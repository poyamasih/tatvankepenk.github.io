# راهنمای راه‌اندازی Supabase برای تاتوان کپنک

این راهنما مراحل لازم برای اتصال اپلیکیشن فلاتر تاتوان کپنک به Supabase را توضیح می‌دهد. با پیروی از این مراحل، محتوای سایت به صورت داینامیک از یک دیتابیس آنلاین بارگذاری خواهد شد.

## 1. ایجاد حساب کاربری و پروژه در Supabase

1. به [سایت Supabase](https://app.supabase.com) بروید و یک حساب کاربری ایجاد کنید.
2. روی دکمه "New Project" کلیک کنید.
3. یک نام برای پروژه خود انتخاب کنید (مثلاً "tatvan-kepenk").
4. یک رمز عبور برای دیتابیس PostgreSQL انتخاب کنید و آن را در جایی امن ذخیره کنید.
5. منطقه‌ای را که از نظر جغرافیایی به کاربران شما نزدیک‌تر است انتخاب کنید.
6. روی دکمه "Create new project" کلیک کنید.

## 2. ایجاد جداول در دیتابیس

1. پس از ایجاد پروژه، به بخش "SQL Editor" در منوی سمت چپ بروید.
2. محتوای فایل `supabase_tables.sql` که در پروژه ایجاد کردیم را کپی کنید.
3. این کد SQL را در ویرایشگر SQL Supabase قرار دهید.
4. روی دکمه "Run" کلیک کنید تا جداول ایجاد شوند.

## 3. تنظیم فضای ذخیره‌سازی (Storage)

1. به بخش "Storage" در منوی سمت چپ بروید.
2. روی دکمه "Create new bucket" کلیک کنید.
3. نام باکت را "tatvan-images" قرار دهید.
4. گزینه "Public bucket" را انتخاب کنید تا تصاویر به صورت عمومی قابل دسترس باشند.
5. روی دکمه "Create bucket" کلیک کنید.

## 4. تنظیم سیاست‌های دسترسی به فضای ذخیره‌سازی

1. روی باکت "tatvan-images" که ایجاد کردید کلیک کنید.
2. به تب "Policies" بروید.
3. برای اجازه دسترسی عمومی برای مشاهده تصاویر، یک سیاست جدید با کلیک روی "New Policy" ایجاد کنید:
   - برای "Policy Type"، "SELECT" را انتخاب کنید.
   - در قسمت "Using expression"، عبارت `true` را وارد کنید.
   - روی "Save policy" کلیک کنید.
4. برای اجازه آپلود تصاویر به کاربران احراز هویت شده، یک سیاست دیگر ایجاد کنید:
   - برای "Policy Type"، "INSERT" را انتخاب کنید.
   - در قسمت "Using expression"، عبارت `auth.role() = 'authenticated'` را وارد کنید.
   - روی "Save policy" کلیک کنید.

## 5. دریافت اطلاعات اتصال به Supabase

1. به بخش "Settings" در منوی سمت چپ، و سپس "API" بروید.
2. مقادیر "URL" و "anon public" را کپی کنید.
3. این مقادیر را در فایل `lib/services/supabase_config.dart` قرار دهید:

```dart
class SupabaseConfig {
  static const String supabaseUrl = 'YOUR_SUPABASE_URL'; // URL را اینجا قرار دهید
  static const String supabaseAnonKey = 'YOUR_ANON_KEY'; // anon key را اینجا قرار دهید
  
  static bool isConfigured() {
    return supabaseUrl != 'https://YOUR_PROJECT_ID.supabase.co' && 
           supabaseAnonKey != 'YOUR_ANON_KEY';
  }
}
```

## 6. تست اتصال

1. اپلیکیشن را اجرا کنید.
2. به صفحه ورود مدیریت بروید (/admin/login).
3. روی دکمه "تست اتصال Supabase" کلیک کنید.
4. اگر پیام "اتصال به Supabase با موفقیت برقرار شد! ✓" را مشاهده کردید، تنظیمات شما صحیح است.

## 7. استفاده از پنل مدیریت Supabase

1. پس از ورود به سیستم، روی دکمه "Supabase" در نوار بالای پنل مدیریت کلیک کنید.
2. در این بخش می‌توانید محتوای سایت را مدیریت کنید و تغییرات مستقیماً به Supabase ارسال می‌شود.

## یادداشت‌های مهم

- **همگام‌سازی داده‌ها**: اگر قبلاً از حالت ذخیره‌سازی محلی استفاده می‌کردید، در اولین ورود به پنل مدیریت Supabase، می‌توانید از دکمه "همگام‌سازی با Supabase" استفاده کنید تا داده‌های محلی به Supabase منتقل شوند.
- **تصاویر آپلود شده**: تصاویری که قبلاً در پوشه محلی `assets/gallery/` ذخیره شده‌اند، باید به صورت دستی به Supabase آپلود شوند یا از طریق پنل مدیریت Supabase مجدداً آپلود شوند.
- **مدیریت کاربران**: اگر می‌خواهید سیستم احراز هویت را نیز به Supabase منتقل کنید، می‌توانید در بخش "Authentication" پروژه Supabase خود کاربر جدیدی ایجاد کنید.

## رفع مشکلات احتمالی

اگر با مشکلی در اتصال به Supabase مواجه شدید، موارد زیر را بررسی کنید:

1. **تنظیمات URL و anon key**: مطمئن شوید که مقادیر وارد شده در فایل `supabase_config.dart` صحیح هستند.
2. **دسترسی به اینترنت**: برنامه باید به اینترنت متصل باشد تا بتواند با Supabase ارتباط برقرار کند.
3. **تنظیمات امنیتی**: مطمئن شوید که سیاست‌های دسترسی (RLS) را به درستی پیکربندی کرده‌اید.
4. **خطاهای کنسول**: خطاهای گزارش شده در کنسول را برای یافتن منبع مشکل بررسی کنید.
